%%[
  /* --------------------------------------------------
     Page 1: Variant overview for a content DE
     -------------------------------------------------- */

  /* 1) Querystring: selection context */
  SET @selectedCategoryId       = RequestParameter("cat")
  SET @selectedDataExtensionKey = RequestParameter("de")

  /* 2) Querystring: soft-delete flags */
  SET @deleteFlag = RequestParameter("delete")
  SET @delCountry = RequestParameter("country")
  SET @delLang    = RequestParameter("lang")
  SET @delType    = RequestParameter("type")
  SET @delVersion = RequestParameter("version")

  /* 3) Output / state defaults */
  SET @selectedCategoryName = ""
  SET @contentRowCount      = 0
  SET @variantRowCount      = 0

  /* 4) Soft delete selected variant (mark IsDeleted=1, keep row) */
  IF NOT EMPTY(@selectedDataExtensionKey) AND @deleteFlag == "1" THEN

    UpdateData(
      @selectedDataExtensionKey,
      4,
      "CountryCode",  @delCountry,
      "LanguageCode", @delLang,
      "Type",         @delType,
      "Version",      @delVersion,
      "IsDeleted",    "1"
    )

  ENDIF

  /* 5) Category name for page titles */
  IF NOT EMPTY(@selectedCategoryId) THEN
    SET @selectedCategoryName = Lookup(
      "CM_ContentCategory",
      "CategoryName",
      "CategoryId",
      @selectedCategoryId
    )
  ENDIF

  /* 6) Content DE list for category (no DE selected yet) */
  IF NOT EMPTY(@selectedCategoryId) AND EMPTY(@selectedDataExtensionKey) THEN

    SET @contentRows = LookupOrderedRows(
      "CM_ContentDataExtension",
      0,
      "CreatedDate ASC",
      "IsDeleted", "0",
      "CategoryId", @selectedCategoryId
    )

    SET @contentRowCount = RowCount(@contentRows)

  ENDIF

  /* 7) Variant list for selected DE (non-deleted; ContentVersion=1 as anchor) */
  IF NOT EMPTY(@selectedDataExtensionKey) THEN

    SET @variantRows = LookupOrderedRows(
      @selectedDataExtensionKey,
      0,
      "CreatedDate ASC",
      "IsDeleted",      "0",
      "ContentVersion", "1"
    )

    SET @variantRowCount = RowCount(@variantRows)

  ENDIF
]%%

%%[ IF NOT EMPTY(@selectedDataExtensionKey) THEN ]%%

  <!-- Header stays inline on Main -->
  <h1 class="card-title">
    %%[ IF NOT EMPTY(@selectedCategoryName) THEN ]%%
      %%=v(@selectedCategoryName)=%% - %%=v(@selectedDataExtensionKey)=%%
    %%[ ELSE ]%%
      %%=v(@selectedDataExtensionKey)=%%
    %%[ ENDIF ]%%
  </h1>

  <div style="text-align: right; margin-bottom: 0.5rem;">
    <a
      href="%%=IIF(EMPTY(@selectedCategoryId),'?',Concat('?cat=',@selectedCategoryId))=%%"
      class="btn-link"
    >
      â†© back
    </a>
  </div>

  <table class="list" style="margin-bottom: 1rem;">
    <tbody>
      <tr>
        <th>Data Extension:</th>
        <td>%%=v(@selectedDataExtensionKey)=%%</td>
      </tr>
    </tbody>
  </table>

  %%=ContentBlockByKey("DMC_P1_ContentList_Versions")=%%

%%[ ELSE ]%%

  %%=ContentBlockByKey("DMC_P1_ContentList_DataExtensions")=%%

%%[ ENDIF ]%%
